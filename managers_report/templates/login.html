{% extends "base.html" %}
{% block title %}Login â€” Manager Dashboard{% endblock %}
{% block content %}
<div class="max-w-md mx-auto mt-12 p-6 bg-white rounded-xl shadow-md">
  <h2 class="text-2xl font-bold mb-6 text-center">Manager Login</h2>
  <form method="post" class="space-y-4">
    <div>
      <label class="block font-semibold">Login</label>
      <input type="text" name="login" value="{{ login_prefill or '' }}" required class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>
    <div>
      <label class="block font-semibold">Password</label>
      <input type="password" name="password" required class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>
    <button type="submit" class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">Sign In</button>
  </form>
  <div class="mt-6 text-center">
    <p class="text-gray-600 mb-2">Or login with Telegram:</p>
    <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="YourBotName" data-size="large" data-onauth="onTelegramAuth(user)"></script>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
function onTelegramAuth(user) {
  fetch('/telegram-login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(user)
  })
  .then(res => res.json())
  .then(data => {
    if (data.ok) {
      window.location.href = '/dashboard';
    } else {
      alert('Telegram login failed: ' + (data.error || 'Unknown error'));
    }
  })
  .catch(err => alert('Error: ' + err.message));
}
</script>
{% endblock %}